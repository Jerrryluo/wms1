{% extends "base.html" %}

{% block title %}出库操作 - 仓库管理系统{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2 style="margin: 0;">出库操作</h2>
    <div class="outgoing-actions" style="margin-top: 32px;"></div>
</div>

<!-- 出库产品选择和数量输入区域 -->
<div class="form-layout">
    <div>
        <label for="outgoing-product-select">选择产品:</label>
        <select id="outgoing-product-select" onchange="showProductSpecs()">
            <option value="">请选择产品</option>
        </select>
    </div>
    <div>
        <label for="outgoing-box-spec">选择规格:</label>
        <select id="outgoing-box-spec">
            <option value="">请选择规格</option>
        </select>
    </div>
    <div>
        <label for="outgoing-quantity">出库数量:</label>
        <input type="number" id="outgoing-quantity" placeholder="出库数量" min="1" required>
    </div>
    <div>
        <label for="outgoing-reason">出库原因:</label>
        <select id="outgoing-reason" required>
            <option value="生产" selected>生产</option>
            <option value="报废">报废</option>
            <option value="盘亏">盘亏</option>
            <option value="操作失误">操作失误</option>
        </select>
    </div>
    <div class="form-button-container">
        <button onclick="addToOutgoingList()">添加到待出库列表</button>
    </div>
</div>

<!-- 待出库列表显示区域 -->
<h3>待出库列表</h3>
<div class="table-container">
    <table id="outgoing-products-table">
        <thead>
            <tr>
                <th>品名</th>
                <th>库位</th>
                <th>规格</th>
                <th>箱数</th>
                <th>批次号</th>
                <th>过期日期</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="outgoing-products-body"></tbody>
    </table>
</div>

<!-- 出库操作按钮组 -->
<div class="outgoing-actions">
    <button onclick="generateDeliveryNote()">生成提货单</button>
    <button onclick="confirmOutgoing()">确认出库</button>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // 页面初始化函数
    function pageInit() {
        loadOutgoingListFromStorage(); // 加载待出库列表
        populateOutgoingProductSelect(); // 加载产品选择框
    }
</script>
{% endblock %}